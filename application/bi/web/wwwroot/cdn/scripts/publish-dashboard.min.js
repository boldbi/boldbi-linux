/*!
*  filename: publish-dashboard.min.js
*  version : unknown version
*  Copyright Syncfusion Inc. 2001 - 2013. All rights reserved.
*  Use of this code is subject to the terms of our license.
*  A copy of the current license can be obtained at any time by e-mailing
*  licensing@syncfusion.com. Any infringement will be prosecuted under
*  applicable laws. 
*/
function publishSiteDetailDialog(n){var r,i,u,t;publishedDashboardInfo=n;r='<span class ="publish-dialog-header">'+(n.ItemType==ItemType.Dashboard?window.Server.App.Localization.PublishDialogHeader:window.Server.App.Localization.PublishDataSourceDialogHeader)+"<\/span>";isPublishDialogBinded?(t=document.getElementById("publish-site-dialog").ej2_instances,t[0].header=r,t[0].btnObj[0].disabled=!0,t[0].show()):(i=document.createElement("div"),i.setAttribute("id","publish-site-dialog"),u=document.getElementById(n.ItemType==ItemType.Dashboard?"dashboard-page-container":"content-area"),u.appendChild(i),t=new ejs.popups.Dialog({header:r,content:document.getElementById("publish-site-content"),buttons:[{click:function(n){n.currentTarget.ej2_instances[0].content==window.Server.App.Localization.Back?backToPublishDialog():advancedPublishDialog()},buttonModel:{disabled:!0,content:window.Server.App.Localization.Advanced}},{click:function(n){n.currentTarget.ej2_instances[0].content==window.Server.App.Localization.Submit&&submitTargetSiteDetails();n.currentTarget.ej2_instances[0].content==window.Server.App.Localization.Next&&backToPublishDialog()},buttonModel:{isPrimary:!0,content:window.Server.App.Localization.Submit}},{click:function(){t.hide();$("#publish-advanced-container").hide();isAdvancedPage=!1},buttonModel:{content:window.Server.App.Localization.CloseButton}},],animationSettings:{effect:"Zoom"},open:validatePublishItem,beforeOpen:beforeOpenPublishDialog,beforeClose:beforeClosePublishDialog,width:"700px",showCloseIcon:!0,isModal:!0}),t.appendTo(i),isPublishDialogBinded=!0);ejs.popups.createSpinner({target:document.getElementById("publish-site-dialog")});ejs.popups.setSpinner({type:"Material"});ejs.popups.showSpinner(document.getElementById("publish-site-dialog"))}function beforeOpenPublishDialog(){$("#publish-site-content").show();$("#publish-advanced-container").hide();var t=document.getElementById("publish-site-dialog").ej2_instances,n=angular.element("[ng-controller=PublishCtrl]").scope();n.itemType=publishedDashboardInfo.ItemType;n.itemType==ItemType.Datasource&&$("#publish-category-name").blur();isSelfHosted&&isMaster?($("#publish-base-container").hide(),$("#publish-select-site-container").show(),t[0].btnObj[1].content=window.Server.App.Localization.Next,t[0].btnObj[0].cssClass="display-none"):(t[0].btnObj[1].content=window.Server.App.Localization.Submit,t[0].btnObj[0].cssClass="",$("#publish-select-site-container").hide(),$("#publish-base-container").show(),n.publishType="External");n.$root.$$phase!="$apply"&&n.$root.$$phase!="$digest"&&n.$apply()}function validatePublishItem(){$("#progress-alert-container > .warning-toast").length>0&&$("#progress-alert-container > .warning-toast").fadeOut();var n=publishedDashboardInfo.ItemType==ItemType.Dashboard?validatePublishItemUrl.dashboard:validatePublishItemUrl.datasource;$.ajax({type:"GET",url:n,data:{itemId:publishedDashboardInfo.Id},success:function(n){var t,i;n.Status?(t=angular.element("[ng-controller=PublishCtrl]").scope(),ejs.popups.hideSpinner(document.getElementById("publish-site-dialog")),isSelfHosted&&isMaster?$("#internal-site").click():(t.publishType="External",backToPublishDialog()),t.linkedDatasources=n.Result!=null?n.Result:[]):(i=document.getElementById("publish-site-dialog").ej2_instances,i[0].hide(),publishedDashboardInfo.ItemType==ItemType.Dashboard?warningToast(window.Server.App.Localization.InvalidPublishItem,window.Server.App.Localization.PublishItemValidation+(isNullOrWhitespace(n.StatusMessage)?"":n.StatusMessage),n.ETag,window.Server.App.Localization.PublishDashboard):warningToast(window.Server.App.Localization.PublishDataSourceValidation,isNullOrWhitespace(n.StatusMessage)?"":n.StatusMessage,n.ETag,window.Server.App.Localization.PublishDataSource))}})}function beforeClosePublishDialog(){var n=angular.element("[ng-controller=PublishCtrl]").scope(),t=document.getElementById("publish-site-dialog").ej2_instances;t[0].btnObj[0].content=window.Server.App.Localization.Advanced;n.selectedSites=[];n.activeSites=[];n.selectedDatasources=[];n.TargetSiteDetail=[];n.userLists=[];n.updateDatasources=[];n.updateUser=[];n.updateSites=[];n.publishType="Internal";n.linkedDatasources=[];$("#multiselect-dropdown").empty();$("#multiselect-dropdown").selectpicker("refresh");$("#publish-category-name").val("");$("#publish-dashboard-description").val("");$("#publish-dashboard-edit").prop("checked",!1);$("#publish-datasource-edit").prop("checked",!1);$("#use-source-name").prop("checked",!1);$("#make-public").prop("checked",!1);$("#advanced-make-public").prop("checked",!1);removeCategoryValidation();removeDropdownValidation()}function advancedPublishDialog(){var t,n,i;isAdvancedPage=!0;ejs.popups.showSpinner(document.getElementById("publish-site-dialog"));t=document.getElementById("publish-site-dialog").ej2_instances;t[0].btnObj[0].content=window.Server.App.Localization.Back;t[0].btnObj[1].content=window.Server.App.Localization.Submit;n=angular.element("[ng-controller=PublishCtrl]").scope();$(".selected-sites li").hasClass("active")?(i=n.selectedSites.some(t=>t.TenantId==n.activeMenu.TenantId),i||(n.activeMenu=n.selectedSites[0])):(n.activeMenu=n.selectedSites[0],$(".selected-sites li:first").addClass("active"));n.$apply();updateUsersList()}function backToPublishDialog(){$('[data-toggle="tooltip"]').tooltip();isAdvancedPage=!1;ejs.popups.showSpinner(document.getElementById("publish-site-dialog"));var n=angular.element("[ng-controller=PublishCtrl]").scope(),t=document.getElementById("publish-site-dialog").ej2_instances;isSelfHosted&&(t[0].btnObj[0].cssClass="",t[0].btnObj[1].content=window.Server.App.Localization.Submit);n.publishType=="Internal"?($("#active-sites-dropdown").removeClass("external-dropdown"),$("#publish-base-container .publish-container").removeClass("external-publish-separator")):($("#active-sites-dropdown").addClass("external-dropdown"),$("#publish-base-container .publish-container").addClass("external-publish-separator"));t[0].btnObj[0].content=window.Server.App.Localization.Advanced;$("#publish-base-container").show();$("#publish-advanced-container").hide();$("#publish-select-site-container").hide();updateDashboardName();$("#multiselect-dropdown > option").length===0?showActiveSites(n.publishType):(ejs.popups.hideSpinner(document.getElementById("publish-site-dialog")),updateTitleForDisabledItem(n.activeSites))}function updateTitleForDisabledItem(n){$.each(n,function(n,t){var i=t.DNS!=undefined?t.DNS:t.SiteURL,r;t.IsPublished?($("#active-sites-dropdown .dropdown-menu .inner .disabled").attr("data-toggle","tooltip"),$("#active-sites-dropdown .dropdown-menu .inner li a").hasClass("no-sites")||(r=publishedDashboardInfo.ItemType==ItemType.Dashboard?window.Server.App.Localization.ItemPublishedTitle:window.Server.App.Localization.DataSourceItemPublishedTitle,$("#active-sites-dropdown .dropdown-menu .inner .disabled").attr("data-original-title","<span class='tooltip-row'><span class='tooltip-label'>URL: <\/span><span class='tooltip-description'>"+i+"<\/span><\/span><br><span class='tooltip-row'><span class='tooltip-label'>Note: <\/span><span class='tooltip-description'>"+r+"<\/span><\/span>").attr("data-placement","right").attr("data-html","true"))):$("#active-sites-dropdown .dropdown-menu .inner li").eq(n).attr("data-toggle","tooltip").attr("data-original-title","<span class='tooltip-row'><span class='tooltip-label'>URL: <\/span><span class='tooltip-description'>"+i+"<\/span><\/span>").attr("data-placement","right").attr("data-html","true")});removeDropdownValidation();$('#publish-site-dialog [data-toggle="tooltip"]').tooltip({delay:{show:500},container:$("#publish-site-dialog")})}function showActiveSites(n){n==="Internal"?(updateActiveSites(),$("#active-sites-dropdown").removeClass("external-dropdown")):(updateExternalSites(),$("#active-sites-dropdown").addClass("external-dropdown"))}function updateUsersList(){var n=angular.element("[ng-controller=PublishCtrl]").scope();n.userDetail=[];n.userLists=[];$.each(n.selectedSites,function(t,i){$.ajax({type:"GET",url:getUsersPermissionUrl,data:{publishType:n.publishType,tenantId:i.TenantId},success:function(r){var u=[];typeof r.Sites!="undefined"&&($.each(r.Sites,function(t,i){n.userDetail.push({Name:i.DisplayName,Id:i.IdPReferenceId,UserId:i.UserId,IsSelected:t==0?!0:!1});angular.copy(n.userDetail,u)}),n.sampleDetail=n.publishType==="Internal"?{SiteIdentifier:i.SiteIdentifier,UserList:u}:{SiteIdentifier:i.TenantId,UserList:u},n.userLists.push(n.sampleDetail),n.sampleDetail=[],n.userDetail=[],n.selectedSites.length-1==t&&publishedDashboardInfo.ItemType==ItemType.Dashboard?(n.selectedDatasources=[],$.ajax({type:"GET",url:getDatasourceUrl,data:{itemId:publishedDashboardInfo.Id},success:function(t){t.Datasources!=null&&$.each(t.Datasources,function(t,i){n.selectedDatasources.push({Id:i.DataSourceId,Name:i.DataSourceName,IsLocked:$("#publish-datasource-edit").is(":checked")})});executeAfterDatasourceUpdated(n)}})):n.selectedSites.length-1==t&&publishedDashboardInfo.ItemType==ItemType.Datasource&&(n.selectedDatasources=[],n.linkedDatasources.length>0&&$.each(n.linkedDatasources,function(t,i){n.selectedDatasources.push({Id:i.Id,Name:i.Name,IsLocked:$("#publish-datasource-edit").is(":checked")})}),executeAfterDatasourceUpdated(n)))}})})}function executeAfterDatasourceUpdated(n){resetAngularEvent&&(n.TargetSiteDetail=[],updateDatasourceIsLocked(),prepareTargetSiteDetail());resetAngularEvent=!1;pushUserList();pushDatasources();$("#user-selected").addClass("selectpicker");$("#user-selected").selectpicker("refresh");$("#publish-base-container").hide();$("#publish-select-site-container").hide();$("#publish-advanced-container").show();ejs.popups.hideSpinner(document.getElementById("publish-site-dialog"))}function submitTargetSiteDetails(){var t=canPublish(),n;t&&(ejs.popups.showSpinner(document.getElementById("publish-site-dialog")),n=angular.element("[ng-controller=PublishCtrl]").scope(),isAdvancedPage||publishedDashboardInfo.ItemType!=ItemType.Dashboard?isAdvancedPage||publishedDashboardInfo.ItemType!=ItemType.Datasource?publishDashboard():(n.linkedDatasources.length>0&&$.each(n.linkedDatasources,function(t,i){n.selectedDatasources.push({Id:i.Id,Name:i.Name,IsLocked:$("#publish-datasource-edit").is(":checked")})}),publishDashboard()):(n.selectedDatasources=[],$.ajax({type:"GET",url:getDatasourceUrl,data:{itemId:publishedDashboardInfo.Id},success:function(t){t.Datasources!=null&&$.each(t.Datasources,function(t,i){n.selectedDatasources.push({Id:i.DataSourceId,Name:i.DataSourceName,IsLocked:$("#publish-datasource-edit").is(":checked")})});publishDashboard()}})))}function publishDashboard(){var n=angular.element("[ng-controller=PublishCtrl]").scope(),r=document.getElementById("publish-site-dialog").ej2_instances,t,i;n.TargetSiteDetail.length==0&&(n.activeMenu=n.selectedSites[0],prepareTargetSiteDetail());pushUserListAll();pushDatasources();t={targetSiteDetail:JSON.stringify(n.TargetSiteDetail),itemId:publishedDashboardInfo.Id};i=publishedDashboardInfo.ItemType==ItemType.Dashboard?publishDashboardUrl.dashboard:publishDashboardUrl.datasource;$.ajax({type:"POST",url:i,data:t,success:function(n){n.Status?publishedDashboardInfo.ItemType==ItemType.Dashboard?successToast(window.Server.App.Localization.PublishDashboardSuccess,7e3,n.ETag):successToast(window.Server.App.Localization.PublishDataSourceSuccess,7e3,n.ETag):publishedDashboardInfo.ItemType==ItemType.Dashboard?warningToast(window.Server.App.Localization.PublishDashboardFailure,n.StatusMessage,n.ETag,window.Server.App.Localization.PublishDashboard):warningToast(window.Server.App.Localization.PublishDataSourceFailure,n.StatusMessage,n.ETag,window.Server.App.Localization.PublishDataSource);ejs.popups.hideSpinner(document.getElementById("publish-site-dialog"));r[0].hide()}})}function prepareTargetSiteDetail(){var n=angular.element("[ng-controller=PublishCtrl]").scope();$.each(n.selectedSites,function(t,i){var r=n.userLists.find(n=>n.SiteIdentifier==i.SiteIdentifier),u=[];angular.copy(n.selectedDatasources,u);n.sampleDetail={SiteIdentifier:i.SiteIdentifier,TenantId:i.TenantId,UserId:typeof r=="undefined"||r.UserList.length==0?0:r.UserList[0].UserId,IdpReferenceIdString:typeof r=="undefined"||r.UserList.length==0?null:r.UserList[0].Id,PublishItem:{CategoryName:$("#publish-category-name").val().trim(),Description:$("#publish-dashboard-description").val().trim(),Name:$("#publish-dashboard-name").val().trim(),IsLocked:$("#publish-dashboard-edit").is(":checked"),IsPublic:$("#make-public").is(":checked")},Datasources:u,PublishType:n.publishType,UseSourceItemName:$("#use-source-name").is(":checked")};n.TargetSiteDetail.push(n.sampleDetail);n.sampleDetail=[]});n.$apply()}function extractSelectedSites(){var n=angular.element("[ng-controller=PublishCtrl]").scope();n.selectedSites=[];$.each($("#active-sites-dropdown option:selected"),function(t,i){var r=n.activeSites.find(n=>n.TenantId==i.attributes.id.value);n.selectedSites.push({SiteIdentifier:r.SiteIdentifier,TenantId:r.TenantId,TenantName:r.TenantName})});activateSubmit();resetAngularEvent=!0;n.$apply()}function pushDatasources(){$("#datasource-list-dropdown").empty();var n=angular.element("[ng-controller=PublishCtrl]").scope(),t=n.TargetSiteDetail.find(t=>t.TenantId==n.activeMenu.TenantId);typeof t!="undefined"&&t.Datasources.length!=0&&$.each(t.Datasources,function(n,t){t.IsLocked?$("#datasource-list-dropdown").append('<option value="'+t.Id+'"selected>'+t.Name+"<\/option>"):$("#datasource-list-dropdown").append('<option value="'+t.Id+'">'+t.Name+"<\/option>")});n.selectedDatasources.length==0&&$("#datasource-list-dropdown").append("<option disabled>"+(ItemType.Dashboard==publishedDashboardInfo.ItemType?window.Server.App.Localization.NoDataSources:window.Server.App.Localization.NoLinkedDataSources)+"<\/option>");$("#datasource-list-dropdown").selectpicker("refresh");$('[data-toggle="tooltip"]').tooltip()}function pushUserList(){var n=angular.element("[ng-controller=PublishCtrl]").scope(),t,i;$("#user-selected").empty();n.selectedUsers=[];t=[];t=n.publishType==="Internal"?n.userLists.find(t=>t.SiteIdentifier==n.activeMenu.SiteIdentifier):n.userLists.find(t=>t.SiteIdentifier==n.activeMenu.TenantId);i=n.TargetSiteDetail.find(t=>t.TenantId==n.activeMenu.TenantId);typeof t!="undefined"&&t.UserList.length!=0&&($.each(t.UserList,function(n,t){t.IsSelected?($("#user-selected").append('<option value="'+t.UserId+'"selected>'+t.Name+"<\/option>"),i.UserId=t.UserId,i.IdpReferenceIdString=t.Id):$("#user-selected").append('<option value="'+t.UserId+'">'+t.Name+"<\/option>")}),$("#user-selected").selectpicker("refresh"))}function pushUserListAll(){var n=angular.element("[ng-controller=PublishCtrl]").scope(),t,i;$("#user-selected").empty();for(let r=0;r<n.TargetSiteDetail.length;r++)$("#user-selected").empty(),n.selectedUsers=[],t=[],t=n.publishType==="Internal"?n.userLists.find(t=>t.SiteIdentifier==n.TargetSiteDetail[r].SiteIdentifier):n.userLists.find(t=>t.SiteIdentifier==n.TargetSiteDetail[r].TenantId),i=n.TargetSiteDetail.find(t=>t.TenantId==n.TargetSiteDetail[r].TenantId),typeof t!="undefined"&&t.UserList.length!=0&&($.each(t.UserList,function(n,t){t.IsSelected?($("#user-selected").append('<option value="'+t.UserId+'"selected>'+t.Name+"<\/option>"),i.UserId=t.UserId,i.IdpReferenceIdString=t.Id):$("#user-selected").append('<option value="'+t.UserId+'">'+t.Name+"<\/option>")}),$("#user-selected").selectpicker("refresh"))}function removeCategoryValidation(){$("#publish-category-validation, #advanced-category-validation, #publish-plugin-validation, #advanced-plugin-validation").html("");$("#publish-category-name, #advanced-category-name").removeClass("has-error")}function removeDropdownValidation(){$("#active-sites-dropdown .bootstrap-select .selectpicker").removeClass("has-error");$("#add-external-sites .btn.btn-default").removeClass("has-error");$("#active-sites-validation").html("");activateSubmit()}function canPublish(){var n=isAdvancedPage?$("#advanced-category-name").val().trim():$("#publish-category-name").val().trim();if($("#active-sites-dropdown li.selected").length>0){if(isAdvancedPage&&isEmptyOrWhitespace(n)&&ItemType.Dashboard==publishedDashboardInfo.ItemType)return $("#advanced-category-validation").html(""),$("#advanced-plugin-validation").html(window.Server.App.Localization.ItemNameValidator),$("#advanced-category-name").addClass("has-error"),!1;if(isEmptyOrWhitespace(n)&&ItemType.Dashboard==publishedDashboardInfo.ItemType)return $("#publish-category-validation").html(""),$("#publish-plugin-validation").html(window.Server.App.Localization.CategoryNameValidator),$("#publish-category-name").addClass("has-error"),!1;removeCategoryValidation();removeDropdownValidation()}else return($("#active-sites-validation").html(window.Server.App.Localization.SelectSites),$("#active-sites-dropdown .bootstrap-select .selectpicker").addClass("has-error"),$("#add-external-sites .btn.btn-default").addClass("has-error"),isAdvancedPage&&isEmptyOrWhitespace(n)&&ItemType.Dashboard==publishedDashboardInfo.ItemType)?($("#advanced-category-validation").html(""),$("#advanced-plugin-validation").html(window.Server.App.Localization.ItemNameValidator),$("#advanced-category-name").addClass("has-error"),!1):isEmptyOrWhitespace(n)&&ItemType.Dashboard==publishedDashboardInfo.ItemType?($("#publish-category-validation").html(""),$("#publish-plugin-validation").html(window.Server.App.Localization.CategoryNameValidator),$("#publish-category-name").addClass("has-error"),!1):(removeCategoryValidation(),!1);return!0}function activateSubmit(){var n=document.getElementById("publish-site-dialog").ej2_instances,t=isAdvancedPage?$("#advanced-category-name").val().trim():$("#publish-category-name").val().trim();n[0].btnObj[0].disabled=$("#active-sites-dropdown li.selected").length>0&&(ItemType.Datasource==publishedDashboardInfo.ItemType||!isEmptyOrWhitespace(t))?!1:!0}function updateDatasourceIsLocked(){var n=angular.element("[ng-controller=PublishCtrl]").scope();$.each(n.selectedDatasources,function(n,t){t.IsLocked=$("#publish-datasource-edit").is(":checked")})}function updateActiveSites(){$.ajax({type:"GET",url:getActiveSitesUrl,data:{itemId:publishedDashboardInfo.Id},success:function(n){var t=angular.element("[ng-controller=PublishCtrl]").scope();$.each(n.Sites,function(n,i){t.activeSites.push({TenantId:i.TenantId,SiteIdentifier:i.TenantIdentifier,TenantName:i.TenantName});i.IsPublished?$("#multiselect-dropdown").append("<option id="+i.TenantId+" value="+i.TenantIdentifier+" disabled > "+i.TenantName+"<\/option > "):$("#multiselect-dropdown").append("<option id= "+i.TenantId+" value = "+i.TenantIdentifier+" > "+i.TenantName+"<\/option > ")});n.Sites.length==0&&$("#multiselect-dropdown").append('<option class = "no-sites" disabled>'+window.Server.App.Localization.NoActiveSites+"<\/option>");$("#multiselect-dropdown").selectpicker("refresh");ejs.popups.hideSpinner(document.getElementById("publish-site-dialog"));updateTitleForDisabledItem(n.Sites)}})}function updateDashboardName(){$("#use-source-name").is(":checked")?$("#publish-dashboard-name").val(publishedDashboardInfo.Name):$("#publish-dashboard-name").val(publishedDashboardInfo.Name+"_"+$.now());$("#advanced-source-name").is(":checked")?$("#advanced-dashboard-name").val(publishedDashboardInfo.Name):$("#advanced-dashboard-name").val(publishedDashboardInfo.Name+"_"+$.now())}function isSiteNameExist(){return!$("#external-site-name").hasClass("has-error")}function getExternalSitesDetailDialog(n,t=0,i){var u,f,e,o,r;$("#validation-message").html("").hide();t==1?(editAction=t,u=n==undefined?window.Server.App.Localization.EditExternalSiteDialogHeader:n!=undefined&&n==0?window.Server.App.Localization.ExternalBISiteEditDialogHeader:window.Server.App.Localization.ExternalReportsSiteEditDialogHeader,f='<span class ="external-sites-dialog-header">'+u+"<\/span>"):(u=n==undefined?window.Server.App.Localization.ExternalSiteDialogHeader:n!=undefined&&n==0?window.Server.App.Localization.ExternalBISiteDialogHeader:window.Server.App.Localization.ExternalReportsSiteDialogHeader,f='<span class ="external-sites-dialog-header">'+u+"<\/span>");isExternalSitesDialogBinded?(ejs.popups.hideSpinner(document.getElementById("external-site-dialog")),r=document.getElementById("external-site-dialog").ej2_instances,r[0].header=f,r[0].beforeOpen=t==0?beforeOpenExternalSitesDialog(0):beforeOpenExternalSitesDialog(1,i),r[0].buttons=[{click:function(i){var r=$("#dialog-container").valid();r?saveExternalSites(n,t):i.preventDefault()},buttonModel:{isPrimary:!0,content:window.Server.App.Localization.SaveButton}},{click:function(){r[0].hide()},buttonModel:{content:window.Server.App.Localization.CancelButton}},],r[0].show()):(e=document.createElement("div"),e.setAttribute("id","external-site-dialog"),o=document.getElementById("content-area"),o.appendChild(e),r=new ejs.popups.Dialog({header:f,content:document.getElementById("get-external-site-content"),buttons:[{click:function(i){var r=$("#dialog-container").valid();r?saveExternalSites(n,t):i.preventDefault()},buttonModel:{isPrimary:!0,content:window.Server.App.Localization.SaveButton}},{click:function(){r.hide()},buttonModel:{content:window.Server.App.Localization.CancelButton}},],animationSettings:{effect:"Zoom"},beforeOpen:t==0?beforeOpenExternalSitesDialog(0):beforeOpenExternalSitesDialog(1,i),beforeClose:beforeCloseExternalSitesDialog,width:"600px",showCloseIcon:!0,isModal:!0}),r.appendTo(e),isExternalSitesDialogBinded=!0,ejs.popups.createSpinner({target:document.getElementById("external-site-dialog")}),ejs.popups.setSpinner({type:"Material"}))}function beforeOpenExternalSitesDialog(n,t){if($("#get-external-site-content").show(),$("#external-site-name, #external-client-id, #external-client-secret, #external-site-url").parent("div").removeClass("has-error"),$(".client-secret-validation-message, .clientid-validation-message, .site-url-validation-message, .name-validation-message").html(""),n==1){var i=$(t).attr("data-name"),u=$(t).attr("data-clientid"),r=$(t).attr("data-site-url"),f=$(t).attr("data-id");$("#external-site-name").val(i);$("#external-client-id").val(u);$("#external-site-url").val(r);oldSiteName=i;oldSiteUrl=r;Id=f}}function pushUrl(n){isFreshLoad?(history.replaceState(n,null,window.location.pathname+"?tab="+n),isFreshLoad=!1):history.pushState(n,null,window.location.pathname+"?tab="+n)}function beforeCloseExternalSitesDialog(){$("#external-site-name, #external-client-id, #external-client-secret, #external-site-url").parent("div").removeClass("has-error");$("#external-client-id, #external-client-secret, #external-site-url, #external-site-name").val("");$(".client-secret-validation-message, .clientid-validation-message, .site-url-validation-message, .name-validation-message").html("");editAction=0}function updateExternalSites(){$.ajax({type:"GET",data:{itemId:publishedDashboardInfo.Id},url:getExternalSitesUrl,success:function(n){var t,i;n.Status&&(t=angular.element("[ng-controller=PublishCtrl]").scope(),$.each(n.Result,function(n,i){t.activeSites.push({TenantId:i.ClientId.toLowerCase(),SiteIdentifier:"",TenantName:i.Name});i.IsPublished?$("#multiselect-dropdown").append("<option id="+i.ClientId.toLowerCase()+" value="+i.ClientId.toLowerCase()+" disabled>"+i.Name+"<\/option>"):$("#multiselect-dropdown").append("<option id="+i.ClientId.toLowerCase()+" value="+i.ClientId.toLowerCase()+" >"+i.Name+"<\/option>")}),n.Result.length==0&&$("#multiselect-dropdown").append('<option class = "no-sites" disabled>'+window.Server.App.Localization.NoActiveSites+"<\/option>"),selectedExternalSites!=null&&selectedExternalSites.length!=0&&($("#multiselect-dropdown").selectpicker("val",selectedExternalSites),extractSelectedSites()),$("#multiselect-dropdown").selectpicker("refresh"),selectedExternalSites=[],ejs.popups.hideSpinner(document.getElementById("publish-site-dialog")),updateTitleForDisabledItem(n.Result),$("#external-site-dialog").length>0&&(i=document.getElementById("external-site-dialog").ej2_instances,i[0].hide()))}})}function saveExternalSites(n,t){var i,r;selectedExternalSites=$("#multiselect-dropdown").val();i={Name:$("#external-site-name").val().trim(),ClientId:$("#external-client-id").val().trim(),ClientSecret:$("#external-client-secret").val().trim(),SiteURL:$("#external-site-url").val().trim(),SiteType:n!=undefined?n:0};selectedExternalSites==null&&(selectedExternalSites=[]);selectedExternalSites.push(i.ClientId);ejs.popups.showSpinner(document.getElementById("external-site-dialog"));r=window.location.href;$.ajax({type:"POST",url:t==1?editExternalSiteUrl:addExternalSitesUrl,data:t==1?{externalSite:i,siteUrl:oldSiteUrl,siteName:oldSiteName,id:Id}:{externalSite:i},success:function(i){var f,u;if(i.Status){if(i.Data){$(".name-validation-message").html(window.Server.App.Localization.SiteNameExist);$("#external-site-name").closest("div").addClass("has-error");ejs.popups.hideSpinner(document.getElementById("external-site-dialog"));return}if(!i.Result){$(".site-url-validation-message").html(window.Server.App.Localization.ExternalSiteUnavailable);$("#external-site-url").closest("div").addClass("has-error");ejs.popups.hideSpinner(document.getElementById("external-site-dialog"));return}r.includes("profile/connected-sites")||r.includes("administration/widgets?tab=reports-widgets")?($("#external-site-dialog").length>0&&(u=document.getElementById("external-site-dialog").ej2_instances,u[0].hide()),n!=undefined&&n==0?getExternalSites():getExternalReportsSites(),t==1?successToast(window.Server.App.Localization.ExternalSiteEditSuccess,7e3,i.ETag):successToast(window.Server.App.Localization.ExternalSiteSuccess,7e3,i.ETag)):($("#multiselect-dropdown").empty(),$("#multiselect-dropdown").selectpicker("refresh"),f=angular.element("[ng-controller=PublishCtrl]").scope(),f.activeSites=[],updateExternalSites())}else{if(i.IsValidClientId!=undefined&&!i.IsValidClientId){$(".clientid-validation-message").html(i.Message);$("#external-client-id").closest("div").addClass("has-error");ejs.popups.hideSpinner(document.getElementById("external-site-dialog"));return}if(i.IsNonAdminAndNonOwner&&(ejs.popups.hideSpinner(document.getElementById("external-site-dialog")),u=document.getElementById("external-site-dialog").ej2_instances,u[0].hide(),warningToast(window.Server.App.Localization.NonAdminAndNonOwner,i.ETag)),i.Data!=undefined&&i.Data){n!=undefined&&n==1||r.includes("profile/connected-sites")?$("#validation-message").html(i.Message).show():$("#validation-message").html(window.Server.App.Localization.ExternalSiteValidationMessage.format(i.Message,"<a href= "+connectedSitesUrl+' target="_blank">',"<\/a>")).show();ejs.popups.hideSpinner(document.getElementById("external-site-dialog"));return}if(i.Result!=undefined&&!i.Result){$("#validation-message").html(i.Message).show();ejs.popups.hideSpinner(document.getElementById("external-site-dialog"));return}if(i.Data!=undefined&&!i.Data){$("#validation-message").html(i.Message).show();ejs.popups.hideSpinner(document.getElementById("external-site-dialog"));return}if(i.Message!=undefined&&i.Message!=null){$("#validation-message").html(i.Message).show();ejs.popups.hideSpinner(document.getElementById("external-site-dialog"));return}ejs.popups.hideSpinner(document.getElementById("external-site-dialog"));t==1?warningToast(i.permissionDenied!=undefined&&i.permissionDenied?window.Server.App.Localization.PermissionWarningAlert:window.Server.App.Localization.ExternalSiteEditFailure,i.permissionDenied!=undefined&&i.permissionDenied?null:i.Message,null,window.Server.App.Localization.ExternalSiteDialogHeader):warningToast(i.permissionDenied!=undefined&&i.permissionDenied?window.Server.App.Localization.PermissionWarningAlert:window.Server.App.Localization.ExternalSiteFailure,i.permissionDenied!=undefined&&i.permissionDenied?null:i.Message,null,window.Server.App.Localization.ExternalSiteDialogHeader);u=document.getElementById("external-site-dialog").ej2_instances;u[0].hide()}}})}function siteNameCheck(n){$.ajax({type:"POST",url:isSiteNameExistsUrl,data:{siteName:n},success:function(n){n.Status?($(".name-validation-message").html(window.Server.App.Localization.SiteNameExist),$("#external-site-name").closest("div").addClass("has-error")):($(".name-validation-message").html(""),$("#external-site-name").closest("div").removeClass("has-error"))}})}function deleteConfirmation(n){var t=null;setTimeout(function(){t=$("#ConnectedSitesGrid").data("ejGrid");var i=t.getCurrentViewData()[t.getIndexByRow($("tr.e-row[aria-selected *='true']"))];messageBox("su-delete",window.Server.App.Localization.DeleteConnectedSite,window.Server.App.Localization.DeleteSiteConfirm.format('<span class ="highlight-name">'+i.Name+"<\/span>"),"error",function(){var t=createLoader("messageBox_wrapper");$("#messageBox_wrapper").ejWaitingPopup({template:$("#"+t)});$("#messageBox_wrapper").css("height",$("#messageBox").outerHeight());$("#messageBox_wrapper").ejWaitingPopup("show");removeExternalSite(n)})},100)}function deleteReportsSiteConfirmation(n){setTimeout(function(){var t=$("#ReportsConnectedSitesGrid").data("ejGrid"),i=t.getCurrentViewData()[t.getIndexByRow($("tr.e-row[aria-selected *='true']"))];messageBox("su-delete",window.Server.App.Localization.DeleteConnectedSite,window.Server.App.Localization.DeleteSiteConfirm.format('<span class ="highlight-name">'+i.Name+"<\/span>"),"error",function(){var t=createLoader("messageBox_wrapper");$("#messageBox_wrapper").ejWaitingPopup({template:$("#"+t)});$("#messageBox_wrapper").css("height",$("#messageBox").outerHeight());$("#messageBox_wrapper").ejWaitingPopup("show");removeExternalReportsSite(n)})},100)}function removeExternalSite(n){var t=$(n).attr("data-id");$.ajax({type:"POST",url:removeExternalSiteUrl,data:{id:t},success:function(n){n.status?(getExternalSites(),successToast(window.Server.App.Localization.DeleteSiteSuccess,7e3)):n.IsNonAdminAndOwner?warningToast(window.Server.App.Localization.NonAdminAndNonOwner,null,null,window.Server.App.Localization.DeleteConnectedSite):warningToast(window.Server.App.Localization.DeleteSiteFailure,null,null,window.Server.App.Localization.DeleteConnectedSite);$("#messageBox_wrapper").ejWaitingPopup("hide");onCloseMessageBox()}})}function removeExternalReportsSite(n){var t=$(n).attr("data-id");$.ajax({type:"POST",url:removeExternalReportsSiteUrl,data:{id:t},success:function(n){n.status?(getExternalReportsSites(),successToast(window.Server.App.Localization.DeleteSiteSuccess,7e3)):warningToast(n.permissionDenied!=undefined&&n.permissionDenied?window.Server.App.Localization.PermissionWarningAlert:window.Server.App.Localization.DeleteSiteFailure,n.permissionDenied!=undefined&&n.permissionDenied?null:n.message,null,window.Server.App.Localization.DeleteConnectedSite);$("#messageBox_wrapper").ejWaitingPopup("hide");onCloseMessageBox()}})}function getExternalSites(){$("#ConnectedSitesGrid").ejWaitingPopup("show");$.ajax({type:"GET",url:getExternalSitesUrl,success:function(n){if(n.Status){var t=$("#ConnectedSitesGrid").data("ejGrid");t.dataSource(n.Result)}$("#ConnectedSitesGrid").ejWaitingPopup("hide")}})}function getExternalReportsSites(){$("#ReportsConnectedSitesGrid").ejWaitingPopup("show");$.ajax({type:"GET",url:getExternalReportsSitesUrl,success:function(n){if(n.status){var t=$("#ReportsConnectedSitesGrid").data("ejGrid");t.dataSource(n.result)}$("#ReportsConnectedSitesGrid").ejWaitingPopup("hide")}})}var publishedDashboardInfo="",isPublishDialogBinded=!1,resetAngularEvent=!1,isAdvancedPage=!1,isFreshLoad;serverApp.controller("PublishCtrl",["$scope","$http",function(n){n.selectedSites=[];n.activeSites=[];n.userLists=[];n.selectedDatasources=[];n.TargetSiteDetail=[];n.sampleDetail=[];n.activeMenu=[];n.PublishedItems=[];n.updateDatasources=[];n.updateUser=[];n.updateSites=[];n.publishType="Internal";n.itemType=ItemType.Dashboard;isSelfHosted||(n.publishType="External");n.selectPublishType=function(t){n.publishType=t};n.setActive=function(t,i){n.activeMenu=t;$(".selected-sites li").removeClass("active");$(i.currentTarget).addClass("active");setTimeout(function(){pushDatasources();pushUserList();$("#user-selected").addClass("selectpicker");$("#user-selected").selectpicker("refresh")},100)}}]);$(document).on("change","#multiselect-dropdown",function(n){n.stopPropagation();extractSelectedSites()});$(document).on("change","#selected-datasources",function(n){n.stopPropagation();var t=angular.element("[ng-controller=PublishCtrl]").scope(),i=t.TargetSiteDetail.find(n=>n.TenantId==t.activeMenu.TenantId),r=i.Datasources.find(t=>t.Id==$("#selected-datasources option")[$(n.target.parentElement).index()].value);r.IsLocked=$(n.target.parentElement).hasClass("selected")?!0:!1});$(document).on("change","#user-selected",function(n){var t=angular.element("[ng-controller=PublishCtrl]").scope(),i=[],r,u;i=t.publishType==="Internal"?t.userLists.find(n=>n.SiteIdentifier==t.activeMenu.SiteIdentifier):t.userLists.find(n=>n.SiteIdentifier==t.activeMenu.TenantId);r=i.UserList.find(n=>n.IsSelected==!0);typeof r!="undefined"&&(r.IsSelected=!1);u=i.UserList.find(t=>t.UserId==$(".users-list option")[$(n.target.parentElement).index()].value);u.IsSelected=!0});$(document).on("change","input","textarea",function(){resetAngularEvent=!0});$(document).on("keyup focusout","#active-sites-dropdown",function(){$("#active-sites-dropdown li.selected").length>0?($("#active-sites-dropdown .bootstrap-select .selectpicker").removeClass("has-error"),$("#add-external-sites .btn.btn-default").removeClass("has-error"),$("#active-sites-validation").html("")):($("#active-sites-validation").html(window.Server.App.Localization.SelectSites),$("#active-sites-dropdown .bootstrap-select .selectpicker").addClass("has-error"),$("#add-external-sites .btn.btn-default").addClass("has-error"));activateSubmit()});$(document).on("keyup focusout","#publish-category-name",function(){var n=$("#publish-category-name").val().trim();isEmptyOrWhitespace(n)?($("#publish-category-validation").html(""),$("#publish-plugin-validation").html(window.Server.App.Localization.CategoryNameValidator),$("#publish-category-name").addClass("has-error")):IsValidName("name",n)?($("#publish-category-name").removeClass("has-error"),$("#publish-category-validation").html(""),$("#publish-plugin-validation").html("")):($("#publish-plugin-validation").html(""),$("#publish-category-validation").html(window.Server.App.Localization.AvoidSpecialCharacters),$("#publish-category-name").addClass("has-error"));activateSubmit()});$(document).on("keyup focusout","#advanced-category-name",function(){var n=$("#advanced-category-name").val().trim();isEmptyOrWhitespace(n)?($("#advanced-category-validation").html(""),$("#advanced-plugin-validation").html(window.Server.App.Localization.ItemNameValidator),$("#advanced-category-name").addClass("has-error")):IsValidName("name",n)?($("#advanced-category-name").removeClass("has-error"),$("#advanced-category-validation").html(""),$("#advanced-plugin-validation").html("")):($("#advanced-plugin-validation").html(""),$("#advanced-category-validation").html(window.Server.App.Localization.AvoidSpecialCharacters),$("#advanced-category-name").addClass("has-error"));activateSubmit()});$(document).on("click","#use-source-name, #advanced-source-name",function(n){if(n.target.attributes[1].value.contains("use-source-name")||n.target.attributes[1].value.contains("advanced-source-name"))updateDashboardName();else{var t=angular.element("[ng-controller=PublishCtrl]").scope();$.each(t.TargetSiteDetail,function(n,i){t.activeMenu.SiteIdentifier==i.SiteIdentifier&&(i.UseSourceItemName?$("#advanced-dashboard-name").val(publishedDashboardInfo.Name):$("#advanced-dashboard-name").val(publishedDashboardInfo.Name+"_"+$.now()),i.PublishItem.Name=$("#advanced-dashboard-name").val().trim())})}});var isExternalSitesDialogBinded=!1,selectedExternalSites=[],editAction=0;$(document).ready(function(){$.validator.addMethod("isRequired",function(n){return!isEmptyOrWhitespace(n)},window.Server.App.Localization.ItemNameValidator);$.validator.addMethod("isValidName",function(n){return IsValidName("name",n)},window.Server.App.Localization.AvoidSpecialCharacters);$.validator.addMethod("additionalSpecialCharValidation",function(n){if(/^[a-zA-Z_0-9`~!\$\^()=\-\.\{\} ]+$/.test(n)||n==="")return!0},window.Server.App.Localization.AvoidSpecialCharacters);$.validator.addMethod("isSiteNameValid",function(n){return isSiteNameExist(n)},window.Server.App.Localization.SiteNameExist);$.validator.addMethod("isValidUrl",function(n){return!isValidUrl(n)},window.Server.App.Localization.IsValidUrl);$("#dialog-container").validate({errorElement:"span",onkeyup:function(n,t){t.keyCode!=9?(isKeyUp=!0,$(n).valid(),isKeyUp=!1):!0},onfocusout:function(n){$(n).valid()},rules:{"external-site-name-input":{isRequired:!0,isValidName:!0,isSiteNameValid:!0,additionalSpecialCharValidation:!0},"external-client-id-input":{isRequired:!0},"external-client-secret-input":{isRequired:!0},"external-site-url-input":{isRequired:!0,isValidUrl:!0}},highlight:function(n){$(n).closest("div").addClass("has-error")},unhighlight:function(n){$(n).closest("div").removeClass("has-error");$(n).closest("div").find("span").html("")},errorPlacement:function(n,t){$(t).closest("div").find("span").html(n.html()).show()},messages:{"external-site-name-input":{isRequired:window.Server.App.Localization.ItemNameValidator},"external-client-id-input":{isRequired:window.Server.App.Localization.ClientId},"external-client-secret-input":{isRequired:window.Server.App.Localization.ClientSecret},"external-site-url-input":{isRequired:window.Server.App.Localization.SiteURL}}})});var oldSiteName="",oldSiteUrl="",Id="";$(document).on("keyup focusout","#external-site-name",function(n){$("#validation-message").html("").hide();var t=$("#external-site-name").val().toLowerCase().trim();n.type==="focusout"?editAction==0?isNullOrWhitespace(t)||siteNameCheck(t):editAction==1&&t!=oldSiteName.toLowerCase().trim()&&(isNullOrWhitespace(t)||siteNameCheck(t)):(isNullOrWhitespace(t)||($(".name-validation-message").html(""),$("#external-site-name").closest("div").removeClass("has-error")),$("[name='external-site-name-input']").valid())});$(document).on("focusout","#external-site-url",function(){$("#validation-message").html("").hide();var n=$("#external-site-url").val().toLowerCase().trim();isNullOrWhitespace(n)||isValidUrl(n)||$("#external-site-url").closest("div").removeClass("has-error")});$(document).on("keyup","#external-site-url",function(){$("#validation-message").html("").hide();$(".site-url-validation-message").html("");$("#external-site-url").closest("div").removeClass("has-error")});$(document).on("focusout","#external-client-id",function(){$("#validation-message").html("").hide()});$(document).on("keyup","#external-client-id",function(){$("#validation-message").html("").hide();$(".clientid-validation-message").html("");$("#external-client-id").closest("div").removeClass("has-error")});isFreshLoad=!0;$(document).on("click",'a[data-toggle="tab"]',function(n){var t=$(n.target).attr("href").replace("#","");pushUrl(t)});window.onpopstate=function(n){$('.nav-tabs a[href="#'+n.state+'"]').tab("show")};$(document).on("mousedown",".show-hide-password",function(){$(this).siblings("input").is(":password")?$(this).siblings("input").attr("type","text"):$(this).siblings("input").attr("type","password")});$(document).on("mouseup",".show-hide-password",function(){$(this).siblings("input").is(":password")?$(this).siblings("input").attr("type","text"):$(this).siblings("input").attr("type","password")});$(document).on("touchstart",".show-hide-password",function(){$(this).siblings("input").is(":password")?$(this).siblings("input").attr("type","text"):$(this).siblings("input").attr("type","password")});$(document).on("touchend",".show-hide-password",function(){$(this).siblings("input").is(":password")?$(this).siblings("input").attr("type","text"):$(this).siblings("input").attr("type","password")});$(document).on("mouseleave",".show-hide-password",function(){$(this).siblings("input").attr("type","password")});if(window.innerWidth<1041)$(document).on("click",".show-hide-password",function(){$(this).siblings("input").is(":password")?$(this).siblings("input").attr("type","text"):$(this).siblings("input").attr("type","password")})