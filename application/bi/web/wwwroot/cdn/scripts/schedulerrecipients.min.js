var listWebhooks="";function getAllStaticData(){null==window.userList&&$.ajax({type:"POST",url:getActiveandInactiveUserUrl,data:{},async:!1,success:function(e){window.userList=e.data.users,window.groupList=e.data.groups}}),$("#user-search").append(window.userList),$("#group-search").append(window.groupList),$(".selectpicker").selectpicker("refresh"),$("#schedule-submit").attr("data-report-id",createdItemId),$(".share-popup .bs-deselect-all").after("<div class='bs-select-all-custom'><span>"+window.Server.App.Localization.Select+"</span><span class='bs-select-custom-tick glyphicon glyphicon-ok' ></span></div>"),$("#user-search-container .bootstrap-select .bs-searchbox .input-block-level").attr("placeholder",window.Server.App.Localization.SearchUsers),$("#group-search-container .bootstrap-select .bs-searchbox .input-block-level").attr("placeholder",window.Server.App.Localization.SearchGroups)}function validateExternalRecipient(){$(document).on("keypress","#external-email",function(e){13==e.which&&(e.preventDefault(),$("#external-submit").click())}),$(document).on("click","#external-submit",function(e){var a=$("#external-email").val().toLowerCase(),t=$(".selected-recipients").children();if(IsEmail(a)){var s=$("<div>").attr("id",a).attr("data-searchtype","externalRecipient").addClass("SelectedShareItems");s.html("<div class='InstantSearch'><span class='details' title='"+a+"'>"+a+"</span><div style='width:auto' class='instant-cancel'><span class='su su-close i-selected-cancel'/></div></div>");for(var o=0;o<t.length;o++)if("externalRecipient"==t[o].getAttribute("data-searchtype")&&a==t[o].id)return $("#external-email").addClass("inactive-box"),$("#external-submit").addClass("inactive-icon"),void $("#external-email-validation").html("<span class='validate-fail'>"+window.Server.App.Localization.IsMailExist+"</span>");$("#selected-users-validation").css("visibility","hidden"),$("#selected-users").append(s),$("#external-email").val(""),selectedItemsCount()}else""!=a?($("#external-email").addClass("inactive-box"),$("#external-submit").addClass("inactive-icon"),$("#external-email-validation").html("<span class='validate-fail'>"+window.Server.App.Localization.IsValidEmail+"</span>")):($("#external-email").removeClass("inactive-box"),$("#external-submit").removeClass("inactive-icon"),$("#external-email-validation").html())}),$(document).on("keyup","#external-email",function(e){13!=e.keyCode&&($("#external-email").removeClass("inactive-box"),$("#external-submit").removeClass("inactive-icon"),$("#external-email-validation").html(""))})}function selectedItemsCount(){$("#selected-users-info").html("<span class='pull-left'>"+window.Server.App.Localization.ScheduleMembers.format($(".SelectedShareItems[data-searchtype='userSearch']").length,$(".SelectedShareItems[data-searchtype='groupSearch']").length,$(".SelectedShareItems[data-searchtype='externalRecipient']").length)+"<span>").css({"padding-top":"10px","padding-left":"15px","margin-top":"0"})}function scheduleSubmit(e,a,t,n,s,o,r,i,l,d,c,p){e.length||$("#export-destination").prop("checked")?(parent.$("#popup-container_wrapper").ejWaitingPopup("show"),parent.$("#editpopup-container_wrapper").ejWaitingPopup("show"),$.ajax({type:"POST",url:s,data:{scheduleList:JSON.stringify({ScheduleItem:o,UserList:r,GroupList:i,ExternalRecipientList:l,result:a,alert:alertChange,DataSourceId:p,FilterData:d,DaJsonString:c})},success:function(e){var a,t,s,o,r,i;e.Success?(scheduleDetail=createScheduleMessage(!0),o=$("#schedule-count").html(),0<(o=parseInt(o)+1)?$("#schedule-count").html(o):$("#schedule-count").html("0"),parent.$("#popup-container_wrapper").ejWaitingPopup("hide"),parent.$("#editpopup-container_wrapper").ejWaitingPopup("hide"),o=$(".schedule-popup-title").text(),closePopupContainer(),n=""==n?".":n,a=140<(r=successMessage+(""==p?" ":"")+scheduleDetail+(""==p?".":n)).length?"success-message-large":"success-message-small",i='<span class="dialog-header-with-icon"><span class ="dialog-header-title"><i class="su su-calendar-1 dialog-header-icon"></i>&nbsp;&nbsp;'+o+"</span></span>",(t=document.createElement("div")).setAttribute("id","schedule-success-dialog"),parent.document.getElementById("server-app-container").appendChild(t),(s=new parent.ejs.popups.Dialog({showOnInit:!1,allowDraggable:!1,enableResize:!1,width:460<window.innerWidth?"450px":window.innerWidth-10,height:"auto",showHeader:!1,animationSettings:{effect:"Zoom"},isModal:!0,enableModal:!0,closeOnEscape:!0,header:i,showCloseIcon:!0,content:r,buttons:[{click:function(){var e;"function"==typeof parent.refreshScheduleGrid&&parent.refreshScheduleGrid(),0<parent.$("#on-board-schedule-dashboard").length&&!parent.$("#on-board-share-dashboard").hasClass("journey-done")&&(parent.$("#on-board-schedule-dashboard").addClass("journey-done").removeAttr("id"),e=parseInt(parent.$(".progress-bar-success").attr("data-progress-percentage"))+parseInt(parent.$(".progress-bar-success").attr("data-increment")),parent.$(".progress-bar-success").css("width",e+"%").attr("data-progress-percentage",e),parent.$(".progress-bar-percentage").text(e+"%")),s.hide()},buttonModel:{cssClass:"app-btn-secondary",content:window.Server.App.Localization.OKButton}}]},a)).appendTo(t)):null==e.HasPermission||e.HasPermission?null!=e.ScheduleNameAlreadyExist&&e.ScheduleNameAlreadyExist&&(parent.$("#popup-container_wrapper").ejWaitingPopup("hide"),parent.$("#editpopup-container_wrapper").ejWaitingPopup("hide"),closePopupContainer(),warningToast(window.Server.App.Localization.IsScheduleExist)):(parent.$("#popup-container_wrapper").ejWaitingPopup("hide"),parent.$("#editpopup-container_wrapper").ejWaitingPopup("hide"),o=$(".schedule-popup-title").text(),closePopupContainer(),r=schedulePermisionWarningMessage,warningToast(schedulePermisionWarningMessage),"function"==typeof parent.refreshScheduleGrid&&parent.refreshScheduleGrid(),0<parent.$("#on-board-schedule-dashboard").length&&!parent.$("#on-board-share-dashboard").hasClass("journey-done")&&(parent.$("#on-board-schedule-dashboard").addClass("journey-done").removeAttr("id"),i=parseInt(parent.$(".progress-bar-success").attr("data-progress-percentage"))+parseInt(parent.$(".progress-bar-success").attr("data-increment")),parent.$(".progress-bar-success").css("width",i+"%").attr("data-progress-percentage",i),parent.$(".progress-bar-percentage").text(i+"%")))}})):$("#selected-users-validation").css("visibility","visible")}function FTPCredentialsValidation(e){("schedule-submit"==e.target.id&&""==$("#host-name").val()||"host-name"==e.target.id&&""==$("#host-name").val())&&$("#host-name").closest("div").addClass("has-error"),"schedule-submit"==e.target.id?(""==$("#host-name").val()&&($("#host-name").closest("div").addClass("has-error"),$("#host-name").closest("div").find("span").html(window.Server.App.Localization.HostNamevalidator).addClass("ftp-credentials-validation-message")),""==$("#user-name").val()&&($("#user-name").closest("div").addClass("has-error"),$("#user-name").closest("div").find("span").html(window.Server.App.Localization.UserNameValidator).addClass("ftp-credentials-validation-message")),""==$("#password").val()&&($("#password").closest("div").addClass("has-error"),$("#password").closest("div").find("span").html(window.Server.App.Localization.PasswordValidator).addClass("ftp-credentials-validation-message"))):("host-name"==e.target.id&&""==$("#host-name").val()&&($("#host-name").closest("div").addClass("has-error"),$("#invalid-hostname").html(window.Server.App.Localization.HostNamevalidator).addClass("ftp-credentials-validation-message")),"user-name"==e.target.id&&""==$("#user-name").val()&&($("#user-name").closest("div").addClass("has-error"),$("#invalid-username").html(window.Server.App.Localization.UserNameValidator).addClass("ftp-credentials-validation-message")),"password"==e.target.id&&""==$("#password").val()&&($("#password").closest("div").addClass("has-error"),$("#invalid-password").html(window.Server.App.Localization.PasswordValidator).addClass("ftp-credentials-validation-message")))}function validateSubscriber(){if(0<!$("#selected-users").children().length)return $("#selectedRecipientErrorContainer").css("display","block"),$("#selectedRecipientValidator").html(window.Server.App.Localization.RecipientValidator),!1;$("#selectedRecipientErrorContainer").css("display","none")}function validateImagedpi(){var e;"image"==$("input[name=exportFormats]:checked","#export-format-container").val().toString().toLowerCase()?0==(e=$("#image-dpi").val())?($("#image-no-value-error").show(),$("#image-dpi-error").hide()):($("#image-no-value-error").hide(),e<=300&&96<=e?($("#image-dpi-error").hide(),$("#schedule-submit").removeAttr("disabled")):($("#schedule-submit").prop("disabled",!0),$("#image-dpi-error").show())):($("#schedule-submit").removeAttr("disabled"),$("#image-dpi-error").show(),$("#image-no-value-error").hide(),$("#image-dpi").val(96))}function pdfActiveOrientation(){$("#pdf-orientation").on("click",".pdf-orientation-format",function(){$(this).addClass("selected-pdf-orientation").siblings().removeClass("selected-pdf-orientation")})}function excelFormatsShow(){$("#show-excel-format").show(),$("#show-image-format").hide(),$("#show-pdf-format").hide(),validateImagedpi()}function imageFormatShow(){$("#show-image-format").show(),$("#show-excel-format").hide(),$("#show-pdf-format").hide(),validateImagedpi()}function pdfFormatShow(){$("#show-pdf-format").show(),$("#show-excel-format").hide(),$("#show-image-format").hide(),validateImagedpi()}function refreshDropdown(e){$("#webhook-select-validations").css("display","none"),isNullOrWhitespace($("#webhook-option").val())&&(listWebhooks=""),$(document).on("show.bs.dropdown",".select-webhook-div",function(){LoadWebhookName($("#webhook-option option:selected").val())}),isNullOrWhitespace($("#webhook-option").val())||$.ajax({type:"POST",url:getWebhookDetailsByIdUrl,data:{webhookId:$("#webhook-option option:selected").val()},success:function(e){$("#webhook-info").css("display","block"),$("#webhook-info span").html(window.Server.App.Localization.WebhookInfoMessage.format("<b>"+e.data.Url+"</b>","<b>"+e.data.ContentTypeDescription+"</b>","POST"))}})}function LoadWebhookName(o){var e=2==alertChange?webhookevent[1]:webhookevent[0];$(".select-webhook-div").find(".open,.bootstrap-select").removeClass("dropdown-alignment"),$(".select-webhook-div .bootstrap-select").append($("<span class='no-padding loader-gif'><div class='loader-blue loader-icon' id='category-dropdown-loader-icon'><svg class='circular'><circle class='path' cx='27' cy='27' r='13' fill='none' stroke-width='4' stroke-miterlimit='10'></circle></svg></div></span>")),$(".select-webhook-div .bootstrap-select .open").hide(),""==listWebhooks?$.ajax({type:"POST",url:getWebhooksUrl,data:{webhookEventType:e},success:function(e){var a=e;listWebhooks="<option value='' data-hidden='true'></option>";for(var t=0;t<a.data.length;t++)listWebhooks+='<option value="'+a.data[t].Id+'">'+a.data[t].Name+"</option>";$("#webhook-option").html(""),$("#webhook-option").html(listWebhooks),$("#webhook-option").selectpicker("refresh"),$(".select-webhook-div.bootstrap-select ul li").each(function(){$(this).hasClass("selected")&&$(this).addClass("active")}),(0<a.data.length?($(".select-webhook-div .bootstrap-select .open").show(),$("#webhook-select-validations")):($("#webhook-select-validations").html(""),$("#webhook-select-validations").css("display","block").html(window.Server.App.Localization.NoWebhook),$("#webhook-info"))).css("display","none"),$(".select-webhook-div span.loader-gif").remove()}}):$.ajax({type:"POST",url:getWebhooksUrl,data:{webhookEventType:e},success:function(e){var a=e;listWebhooks="<option value='' data-hidden='true'></option>";for(var t=0;t<a.data.length;t++)listWebhooks+='<option value="'+a.data[t].Id+'">'+a.data[t].Name+"</option>";$("#webhook-option").html(""),$("#webhook-option").html(listWebhooks);for(var s=0;s<a.data.length;s++)null!=o&&o==a.data[s].Id&&($("#webhook-option option[value='"+a.data[s].Id+"']").attr("selected",!0),$(".select-webhook-div .filter-option").html(a.data[s].Name));$(".select-webhook-div.bootstrap-select ul li").each(function(){$(this).hasClass("selected")&&$(this).addClass("active")}),$("#webhook-option").selectpicker("refresh"),(0<a.data.length?($(".select-webhook-div .bootstrap-select .open").show(),$("#webhook-select-validations")):($("#webhook-select-validations").html(""),$("#webhook-select-validations").css("display","block").html(window.Server.App.Localization.NoWebhook),$("#webhook-info"))).css("display","none"),$(".select-webhook-div span.loader-gif").remove()}}),$(".select-webhook-div").find(".open,.bootstrap-select").addClass("dropdown-alignment")}$(document).on("click","#export-destination",function(){$("#host-name, #user-name, #password").val("").closest("div").removeClass("has-error"),$("#webhook-select-validations").css("display","none"),$("#invalid-hostname, #invalid-username, #invalid-password").html("").hide(),$("#ftp-validation-message").text("").removeClass("ftp-credentials-validation-message"),$("#selected-users-validation").css("visibility","hidden"),$("#export-destination").prop("checked")?($("#host-name, #user-name, #password, #ftp-destination, #webhook-destination").attr("disabled",!1),$(".select-webhook-div .selectpicker").removeClass("disabled"),$("#create-webhook").removeClass("disabled"),$("#webhook-option, #refresh-webhook").attr("disabled",!1),$("#webhook-option").selectpicker("refresh"),$(document).on("show.bs.dropdown",".select-webhook-div",function(){LoadWebhookName($("#webhook-option option:selected").val())})):($("#host-name, #user-name, #password,#ftp-destination, #webhook-destination").attr("disabled",!0),$("#webhook-option").find("option").remove(),$("#webhook-option").selectpicker("refresh"),$("#webhook-option").attr("disabled",!0).val(""),$("#refresh-webhook").attr("disabled",!0),$(".select-webhook-div .btn").addClass("disabled"),$("#create-webhook").addClass("disabled"),$("#webhook-info").css("display","none"))}),$(document).on("change","input[name='destinationType']",function(){$("#host-name, #user-name, #password").val("").closest("div").removeClass("has-error"),$("#invalid-hostname, #invalid-username, #invalid-password").html("").hide(),$("#ftp-validation-message").text("").removeClass("ftp-credentials-validation-message"),$("#webhook-select-validations").css("display","none"),$("#webhook-destination").is(":checked")?($(".webhook-location-div").removeClass("hide").addClass("show"),$(".ftp-location-div").removeClass("show").addClass("hide"),$(".select-webhook-div .selectpicker").removeClass("disabled"),$("#create-webhook").removeClass("disabled"),$("#webhook-option, #refresh-webhook").attr("disabled",!1),$("#webhook-option").selectpicker("refresh"),$("#host-name, #user-name, #password").val(""),listWebhooks=""):($("#webhook-info").css("display","none"),$("#host-name, #user-name, #password").attr("disabled",!1),$(".webhook-location-div").removeClass("show").addClass("hide"),$(".ftp-location-div").removeClass("hide").addClass("show"),$("#webhook-option").find("option").remove(),$("#webhook-option").selectpicker("refresh"),$(".select-webhook-div.bootstrap-select ul li").each(function(){$(this).hasClass("selected")&&($(this).removeClass("active"),$(this).removeClass("selected"))}))}),$(document).on("click","#user-search-container .bs-select-all-custom",function(e){$("#user-search-container").addClass("value-changed"),$("#user-search").data("selectpicker").selectAll(),$("#user-search").trigger("change"),$(this).removeClass("bs-select-all-custom").addClass("bs-deselect-all-custom"),$($(this).children("span")[0]).text(window.Server.App.Localization.Clear),selectedItemsCount(),e.stopPropagation()}),$(document).on("click","#group-search-container .bs-select-all-custom",function(e){$("#group-search-container").addClass("value-changed"),$("#group-search").data("selectpicker").selectAll(),$("#group-search").trigger("change"),$(this).removeClass("bs-select-all-custom").addClass("bs-deselect-all-custom"),$($(this).children("span")[0]).text(window.Server.App.Localization.Clear),selectedItemsCount(),e.stopPropagation()}),$(document).on("click","#user-search-container .bs-deselect-all-custom",function(e){$("#user-search-container").addClass("value-changed"),$("#user-search").data("selectpicker").deselectAll(),$("#user-search").trigger("change"),$(this).removeClass("bs-deselect-all-custom").addClass("bs-select-all-custom"),$($(this).children("span")[0]).text(window.Server.App.Localization.Select),$(".SelectedShareItems[data-searchtype='userSearch']").remove(),selectedItemsCount(),e.stopPropagation()}),$(document).on("click","#group-search-container .bs-deselect-all-custom",function(e){$("#group-search-container").addClass("value-changed"),$("#group-search").data("selectpicker").deselectAll(),$("#group-search").trigger("change"),$(this).removeClass("bs-deselect-all-custom").addClass("bs-select-all-custom"),$($(this).children("span")[0]).text(window.Server.App.Localization.Select),$(".SelectedShareItems[data-searchtype='groupSearch']").remove(),selectedItemsCount(),e.stopPropagation()}),$(document).on("change","#user-search",function(e){var i=[];$("#user-search-container").addClass("value-changed"),$("#user-search-container .bootstrap-select li.selected").length==$("#user-search-container .bootstrap-select li").length&&($($("#user-search-container div.bs-select-all-custom").children("span")[0]).text(window.Server.App.Localization.Clear),$("#user-search-container div.bs-select-all-custom").removeClass("bs-select-all-custom").addClass("bs-deselect-all-custom")),$(this).find("option").each(function(e,a){if($(this).is(":selected")){var t=a,s=$("<div>").attr("id",$(t).val()).attr("data-searchtype","userSearch").addClass("SelectedShareItems"),o=(s.html("<div class='InstantSearch'><span class='details' title='"+$(t).text()+"'>"+$(t).text()+"</span><div style='width:auto' class='instant-cancel'><span class='su su-close i-selected-cancel'/></div></div>"),$("#selected-users-validation").css("visibility","hidden"),$("<div>").attr("id",$(t).val()).attr("data-searchtype","userSearch").addClass("SelectedShareItems"));$("#selected-users").children().each(function(){var e=$(this).attr("id");i.push(e)}),0!=i.length&&i.includes(o.attr("id"))||$("#selected-users").append(s)}else{t=a;if(1<$(".SelectedShareItems[id='"+$(t).val()+"']").length)for(var r=0;r<$(".SelectedShareItems[id='"+$(t).val()+"']").length;r++)"userSearch"==$($(".SelectedShareItems[id='"+$(t).val()+"']")[r]).attr("data-searchtype")&&$($(".SelectedShareItems[id='"+$(t).val()+"']")[r]).remove();else $(".SelectedShareItems[id='"+$(t).val()+"']").remove();$($("#user-search-container .bs-deselect-all-custom").children("span")[0]).text(window.Server.App.Localization.Select),$("#user-search-container .bs-deselect-all-custom").removeClass("bs-deselect-all-custom").addClass("bs-select-all-custom")}}),selectedItemsCount(),e.stopPropagation()}),$(document).on("change","#group-search",function(e){var r=[];$("#group-search-container").addClass("value-changed"),$("#group-search-container .bootstrap-select li.selected").length==$("#group-search-container .bootstrap-select li").length&&($($("#group-search-container div.bs-select-all-custom").children("span")[0]).text(window.Server.App.Localization.Clear),$("#group-search-container div.bs-select-all-custom").removeClass("bs-select-all-custom").addClass("bs-deselect-all-custom")),$(this).find("option").each(function(e,a){var t,s,o;$(this).is(":selected")?(s=a,(t=$("<div>").attr("id",$(s).val()).attr("data-searchtype","groupSearch").addClass("SelectedShareItems")).html("<div class='InstantSearch'><span class='details' title='"+$(s).text()+"'>"+$(s).text()+"</span><div style='width:auto' class='instant-cancel'><span class='su su-close i-selected-cancel'/></div></div>"),$("#selected-users-validation").css("visibility","hidden"),$("#selected-users-validation").css("visibility","hidden"),o=$("<div>").attr("id",$(s).val()).attr("data-searchtype","groupSearch").addClass("SelectedShareItems"),$("#selected-users").children().each(function(){var e=$(this).attr("id");r.push(e)}),0!=r.length&&r.includes(o.attr("id"))||$("#selected-users").append(t)):(s=a,o=$("<div>").attr("id",$(s).val()).attr("data-searchtype","groupSearch").addClass("SelectedShareItems"),r.pop(o.attr("id")),$(".SelectedShareItems").filter("[data-searchtype='groupSearch']").filter("#"+$(s).val()).remove(),$($("#group-search-container .bs-deselect-all-custom").children("span")[0]).text(window.Server.App.Localization.Select),$("#group-search-container .bs-deselect-all-custom").removeClass("bs-deselect-all-custom").addClass("bs-select-all-custom"))}),selectedItemsCount(),e.stopPropagation()}),$(document).on("click","#subscribers-panel .i-selected-cancel",function(e){var a=$(this).parents(".SelectedShareItems").attr("id"),t=$(this).parents(".SelectedShareItems").attr("data-searchtype");"userSearch"==t?(currentElementIndex=$("#user-search").find("[value='"+a+"']").index(),$("#user-search-container .bootstrap-select li").filter("[data-original-index='"+currentElementIndex+"']").find("a").click()):"groupSearch"==t?(currentElementIndex=$("#group-search").find("[value='"+a+"']").index(),$("#group-search-container .bootstrap-select li").filter("[data-original-index='"+currentElementIndex+"']").find("a").click()):"externalRecipient"==t&&$(this).parent().parent().parent().remove(),selectedItemsCount(),$("#selected_childdashboard").attr("disabled",!1)}),$(document).on("hide.bs.dropdown","#user-search-container",function(e){$("#user-search-container").hasClass("value-changed")&&($("#user-search-container").removeClass("value-changed"),e.stopPropagation())}),$(document).on("hide.bs.dropdown","#group-search-container",function(e){$("#group-search-container").hasClass("value-changed")&&($("#group-search-container").removeClass("value-changed"),e.stopPropagation())}),$(document).on("show.bs.dropdown","#user-search-container",function(e){$("#user-search").next("div").find(".dropdown-menu").addClass("dropdown-width");for(var a=0;a<$("#user-search option").length;a++)"false"==$("#user-search option").eq(a).attr("data-show").toLowerCase()&&($("#user-search-container .dropdown-menu .inner li").eq(a).addClass("disabled user-disabled"),$("#user-search-container .dropdown-menu .inner li").eq(a).attr("data-toggle","tooltip").attr("data-placement","top").attr("data-original-title",window.Server.App.Localization.AutoGeneratedMail)),$('[data-toggle="tooltip"]').tooltip()}),$(document).on("show.bs.dropdown","#group-search-container",function(e){$("#group-search").next("div").find(".dropdown-menu").addClass("dropdown-width")}),$(document).on("click","#schedule-submit",function(e){validateSubscriber();var t=" ",s="",o="",r=(2==alertChange&&(t=window.Server.App.Localization.ConditionEvaluted,successMessage=window.Server.App.Localization.DataAlertConfigureSuccess,s=window.Server.App.Localization.DataAlertConfigureSuccessMessage,$(".time-width").val()),{}),a=(r.ScheduleName=$("#schedule-name").val(),r.ItemId=$(this).attr("data-report-id"),r.ExportType=$("input[name=exportFormats]:checked","#export-format-container").val().toString(),schedulePermisionWarningMessage="Create"==actionType?(successMessage=window.Server.App.Localization.DashboardScheduleSuccess,o=addScheduleUrl,window.Server.App.Localization.AddSchedulePermissionWarningAlert):(successMessage=window.Server.App.Localization.ScheduleUpdateSuccess,r.ScheduleId=$(this).attr("data-schedule-id"),r.FailureOccurrence=scheduleRecurrenceInfo.FailureOccurrence,o=updateScheduleUrl,window.Server.App.Localization.UpdateSchedulePermissionWarningAlert),r.ExportType.toLowerCase()),i=("image"==a?(r.ImageFormat=$("#image-format").val(),r.ImageResolution=$("#image-dpi").val()):"pdf"==a?(r.PdfSize=$("#pdf-format").val(),a="",a=$("#pdf-portrait").hasClass("selected-pdf-orientation")?"Portrait":"Landscape",r.PdfOrientation=a):r.ExcelFormat=$("#excel-format").val(),""),n="",l="",a=scheduleEmailEditRTE.value,d=(a=getRelativePath(a),2==alertChange&&(i=filterContent.Filters,n=filterContent.DaJsonString,l=filterContent.DataSourceId),r.EmailContent=a,r.EmailSubject=$("#subject-area").val(),$("#alert-value").text());switch($("#recurrence-type").val().toString().toLowerCase()){case"daily":$("#daily-every-x-days").prop("checked")?(r.RecurrenceType="Daily",r.RecurrenceInterval=$("#every-x-days").val()):r.RecurrenceType="DailyWeekDay";break;case"weekly":r.RecurrenceType="Weekly",r.RecurrenceInterval=$("#every-x-weeks").val(),r.Sunday=$("#sun").prop("checked"),r.Monday=$("#mon").prop("checked"),r.Tuesday=$("#tues").prop("checked"),r.Wednesday=$("#wed").prop("checked"),r.Thursday=$("#thu").prop("checked"),r.Friday=$("#fri").prop("checked"),r.Saturday=$("#sat").prop("checked");break;case"monthly":$("#monthly").prop("checked")?(r.RecurrenceType="Monthly",r.DaysOfMonth=$("#monthly-date").val(),r.RecurrenceInterval=$("#monthly-every-x-months").val()):(r.RecurrenceType="MonthlyDOW",r.WeekOfMonth=$("#monthly-dow-week").find("option:selected").text(),r.DayOfWeek=$("#monthly-dow-day").find("option:selected").text(),r.RecurrenceInterval=$("#monthly-dow-every-x-months").val());break;case"yearly":r.RecurrenceInterval=$("#every-x-years").val(),$("#yearly").prop("checked")?(r.RecurrenceType="Yearly",r.DaysOfMonth=$("#yearly-day").val(),r.MonthOfYear=$("#yearly-month").find("option:selected").text()):(r.RecurrenceType="YearlyDOW",r.WeekOfMonth=$("#yearly-dow-week").find("option:selected").text(),r.DayOfWeek=$("#yearly-dow-day").find("option:selected").text(),r.MonthOfYear=$("#yearly-dow-month").find("option:selected").text());break;case"hourly":r.RecurrenceType="Hourly",r.Frequency=$(".time-width").val(),r.RecurrenceInterval=$("#every-x-hours-value").val()}switch(r.IsEnabled=$("#enable-schedule").prop("checked"),r.FailureNotificationToOwner=$("#enable-notification-to-owner").prop("checked"),r.FailureNotificationToRecipient=$("#enable-notification-to-recipient").prop("checked"),r.StartDate=$("#start-date").val(),$("input[name=end-type]:checked","#schedule-end-type").val().toString()){case"never":r.ScheduleEndType="NoEnd";break;case"endafter":r.ScheduleEndType="EndAfter",r.RecurrenceFactor=$("#occurence-count").val();break;case"endBy":r.ScheduleEndType="EndBy",r.EndDate=$("#end-date").val()}for(var c=$(".selected-recipients").children(),p=Array(),h=Array(),u=Array(),m=0,v=0,b=0,w=0;w<c.length;w++)"userSearch"==c[w].getAttribute("data-searchtype")&&-1!=m&&(p[m]=c[w].id,m++),"groupSearch"==c[w].getAttribute("data-searchtype")&&-1!=v&&(h[v]=c[w].id,v++),"externalRecipient"==c[w].getAttribute("data-searchtype")&&-1!=b&&(u[b]=c[w].id,b++);$("#export-destination").prop("checked")?$("#ftp-destination").prop("checked")?(r.IsFTPExportOptionEnabled=$("#ftp-destination").prop("checked"),r.FtpURL=$("#host-name").val(),r.FtpUsername=$("#user-name").val(),r.FtpPassword=$("#password").val(),FTPCredentialsValidation(e),""!=$("#host-name").val()&&""!=$("#user-name").val()&&""!=$("#password").val()&&(parent.$("#popup-container_wrapper").ejWaitingPopup("show"),parent.$("#editpopup-container_wrapper").ejWaitingPopup("show"),$.ajax({type:"POST",url:validateFTPCredentials,data:{hostName:$("#host-name").val(),username:$("#user-name").val(),password:$("#password").val()},success:function(e){var a=null!=e.ErrorMessage?e.ErrorMessage:"";parent.$("#popup-container_wrapper").ejWaitingPopup("hide"),parent.$("#editpopup-container_wrapper").ejWaitingPopup("hide"),e.IsFtpCredentialsAreValid?scheduleSubmit(c,d,t,s,o,r,p,h,u,i,n,l):$("#ftp-validation-message").text(a).addClass("ftp-credentials-validation-message")}}))):isNullOrWhitespace($("#webhook-option").val())?$("#webhook-select-validations").css("display","block").html(window.Server.App.Localization.SelectWebhook):(r.IsWebhookOptionEnabled=$("#webhook-destination").prop("checked"),r.WebhookName=$(".select-webhook-div .filter-option").html(),r.WebhookId=$("#webhook-option option:selected").val(),scheduleSubmit(c,d,t,s,o,r,p,h,u,i,n,l)):scheduleSubmit(c,d,t,s,o,r,p,h,u,i,n,l)}),$(".show-hide-password").on("mousedown",function(){$(this).siblings("input").is(":password")?$(this).siblings("input").attr("type","text"):$(this).siblings("input").attr("type","password")}),$(".show-hide-password").on("mouseup",function(){$(this).siblings("input").is(":password")?$(this).siblings("input").attr("type","text"):$(this).siblings("input").attr("type","password")}),$(document).on("focusout","#host-name, #user-name, #password",function(e){FTPCredentialsValidation(e)}),$(document).on("keyup","#host-name",function(){$("#host-name").closest("div").removeClass("has-error"),$("#host-name").closest("div").find("span").html("").hide(),$("#ftp-validation-message").text("").removeClass("ftp-credentials-validation-message")}),$(document).on("keyup","#user-name",function(){$("#user-name").closest("div").removeClass("has-error"),$("#user-name").closest("div").find("span").html("").hide(),$("#ftp-validation-message").text("").removeClass("ftp-credentials-validation-message")}),$(document).on("keyup","#password",function(){$("#password").closest("div").removeClass("has-error"),$("#password").closest("div").find("span").html("").hide(),$("#ftp-validation-message").text("").removeClass("ftp-credentials-validation-message")}),$("#webhook-option").on("change",function(e){$("#webhook-select-validations").css("display","none"),e.stopPropagation(),$.ajax({type:"POST",url:getWebhookDetailsByIdUrl,data:{webhookId:$("#webhook-option option:selected").val()},success:function(e){$("#webhook-info").css("display","block"),$("#webhook-info span").html(window.Server.App.Localization.WebhookInfoMessage.format("<b>"+e.data.Url+"</b>","<b>"+e.data.ContentTypeDescription+"</b>","POST"))}})}),$(document).ready(function(){if($(".schedule-dialog #subscribers-panel").css("display","inline"),getAllStaticData(),$('[data-toggle="tooltip"]').tooltip(),"Create"==actionType)$("select#user-search option").each(function(e){var a,t;""!=$(this).val()&&$(this).val().toLowerCase()==$("#userName").val().toLowerCase()&&(a=$(this).text(),$(this).attr("selected",!0),$("#user-search").selectpicker("refresh"),(t=$("<div>").attr("id",$(this).val()).attr("data-searchtype","userSearch").addClass("SelectedShareItems")).html("<div class='InstantSearch'><span class='details' title='"+a+"'>"+a+"</span><div style='width:auto' class='instant-cancel'><span class='su su-close i-selected-cancel'/></div></div>"),$("#selected-users").append(t))}),canExport.Image?($("#image-export").prop("checked",!0),$("#show-excel-format").hide(),$("#show-image-format").show(),$("#show-pdf-format").hide()):canExport.Pdf?($("#pdf-export").prop("checked",!0),$("#show-excel-format").hide(),$("#show-image-format").hide(),$("#show-pdf-format").show()):canExport.Excel&&($("#excel-export").prop("checked",!0),$("#show-excel-format").show(),$("#show-image-format").hide(),$("#show-pdf-format").hide());else{for(var e=0;e<subscriberUser.length;e++){$("#user-search option[value='"+subscriberUser[e]+"']").attr("selected",!0),$("#user-search").selectpicker("refresh");var a=$("#user-search option[value='"+subscriberUser[e]+"']").text(),t=$("<div>").attr("id",subscriberUser[e]).attr("data-searchtype","userSearch").addClass("SelectedShareItems");t.html("<div class='InstantSearch'><span class='details' title='"+a.trim()+"'>"+a.trim()+"</span><div style='width:auto' class='instant-cancel'><span class='su su-close i-selected-cancel'/></div></div>"),$("#selected-users").append(t)}oldUserSelected=$("#user-search").val();for(e=0;e<subscriberGroup.length;e++){$("#group-search option[value='"+subscriberGroup[e]+"']").attr("selected",!0),$("#group-search").selectpicker("refresh");var s=$("#group-search option[value='"+subscriberGroup[e]+"']").text(),o=$("<div>").attr("id",subscriberGroup[e]).attr("data-searchtype","groupSearch").addClass("SelectedShareItems");o.html("<div class='InstantSearch'><span class='details' title='"+s.trim()+"'>"+s.trim()+"</span><div style='width:auto' class='instant-cancel'><span class='su su-close i-selected-cancel'/></div></div>"),$("#selected-users").append(o)}oldGroupSelected=$("#group-search").val();for(e=0;e<subscriberExternalRecipient.length;e++){var r=subscriberExternalRecipient[e],i=$("<div>").attr("id",subscriberExternalRecipient[e]).attr("data-searchtype","externalRecipient").addClass("SelectedShareItems");i.html("<div class='InstantSearch'><span class='details'title='"+r+"'>"+r+"</span><div style='width:auto' class='instant-cancel'><span class='su su-close i-selected-cancel'/></div></div>"),$("#selected-users").append(i)}var n=$("#group-search-container .bootstrap-select li.selected").length,l=$("#group-search-container .bootstrap-select li").length,d=$("#user-search-container .bootstrap-select li.selected").length,c=$("#user-search-container .bootstrap-select li").length,n=(n===l&&$("#group-search-container .bs-select-all-custom").removeClass("bs-select-all-custom").addClass("bs-deselect-all-custom"),d===c&&$("#user-search-container .bs-select-all-custom").removeClass("bs-select-all-custom").addClass("bs-deselect-all-custom"),$("#image-export").prop("checked","image"==exportType.toLowerCase()),$("#pdf-export").prop("checked","pdf"==exportType.toLowerCase()),$("#excel-export").prop("checked","excel"==exportType.toLowerCase()),scheduleExportInfo.ExportFormatInfo);$("#schedule-submit").attr("data-schedule-id",scheduleId),"image"==exportType.toLowerCase()&&canExport.Image?($("#image-export").prop("checked","image"==exportType.toLowerCase()),$("#show-excel-format").hide(),$("#show-image-format").show(),$("#show-pdf-format").hide(),$("#image-format").val(n.Extension).change(),$("#image-dpi").val(n.Resolution)):"pdf"==exportType.toLowerCase()&&canExport.Pdf?($("#pdf-export").prop("checked","pdf"==exportType.toLowerCase()),$("#show-excel-format").hide(),$("#show-image-format").hide(),$("#show-pdf-format").show(),("A3"==n.Size||"A4"==n.Size||"A5"==n.Size||"Letter"==n.Size?$("#pdf-format").val(n.Size):$("#pdf-format").val("A4")).change(),"Portrait"==n.Orientation?($("#pdf-portrait").addClass("selected-pdf-orientation"),$("#pdf-landscape").removeClass("selected-pdf-orientation")):($("#pdf-portrait").removeClass("selected-pdf-orientation"),$("#pdf-landscape").addClass("selected-pdf-orientation"))):($("#excel-export").prop("checked","excel"==exportType.toLowerCase()||canExport.Excel),$("#show-excel-format").show(),$("#show-image-format").hide(),$("#show-pdf-format").hide(),("xlsx"==n.Extension||"xls"==n.Extension?$("#excel-format").val(n.Extension):$("#excel-format").val("xlsx")).change())}var p;scheduleRecurrenceInfo.FailureNotificationToOwner&&$("#enable-notification-to-owner").prop("checked",!0),scheduleRecurrenceInfo.FailureNotificationToRecipient&&$("#enable-notification-to-recipient").prop("checked",!0),null!=scheduleExportInfo.ScheduleExportLocation&&null!=scheduleExportInfo.ScheduleExportLocation&&scheduleExportInfo.ScheduleExportLocation.IsFTPExportOptionEnabled?($("#ftp-destination, #webhook-destination").attr("disabled",!1),$("#export-destination").prop("checked",!0),$("#ftp-destination").prop("checked",!0),$(".webhook-location-div").removeClass("show").addClass("hide"),$(".ftp-location-div").removeClass("hide").addClass("show"),$("#host-name, #user-name, #password").attr("disabled",!1),$("#host-name").val(scheduleExportInfo.ScheduleExportLocation.FtpURL),$("#user-name").val(scheduleExportInfo.ScheduleExportLocation.FtpUsername)):null!=scheduleExportInfo.ScheduleExportLocation&&null!=scheduleExportInfo.ScheduleExportLocation&&scheduleExportInfo.ScheduleExportLocation.IsWebhookOptionEnabled&&($("#export-destination").prop("checked",!0),$("#webhook-destination").prop("checked",!0),$(".webhook-location-div").removeClass("hide").addClass("show"),$(".ftp-location-div").removeClass("show").addClass("hide"),$("#ftp-destination, #webhook-destination").attr("disabled",!1),$(".select-webhook-div .selectpicker").removeClass("disabled"),$("#create-webhook").removeClass("disabled"),$("#webhook-option, #refresh-webhook").attr("disabled",!1),$("#webhook-option").find("option").remove(),$("#webhook-option").selectpicker("refresh"),$(".select-webhook-div .filter-option").html(scheduleExportInfo.ScheduleExportLocation.WebhookName),p=!(listWebhooks=""),l=2==alertChange?webhookevent[1]:webhookevent[0],$.ajax({type:"POST",url:getWebhooksUrl,data:{webhookEventType:l},success:function(e){var a=e;listWebhooks="<option value='' data-hidden='true'></option>";for(var t=0;t<a.data.length;t++)listWebhooks+='<option value="'+a.data[t].Id+'">'+a.data[t].Name+"</option>";$("#webhook-option").html(""),$("#webhook-option").html(listWebhooks);for(var s=0;s<a.data.length;s++)scheduleExportInfo.ScheduleExportLocation.WebhookId==a.data[s].Id&&($("#webhook-option option[value='"+a.data[s].Id+"']").attr("selected",!0),p=!1);$(".select-webhook-div.bootstrap-select ul li").each(function(){$(this).hasClass("selected")&&$(this).addClass("active")}),p||$.ajax({type:"POST",url:getWebhookDetailsByIdUrl,data:{webhookId:scheduleExportInfo.ScheduleExportLocation.WebhookId},success:function(e){$("#webhook-info").css("display","block"),$("#webhook-info span").html(window.Server.App.Localization.WebhookInfoMessage.format("<b>"+e.data.Url+"</b>","<b>"+e.data.ContentTypeDescription+"</b>","POST"))}})}})),selectedItemsCount(),validateExternalRecipient(),addTitleForUsersAndGroups(),parent.$("#popup-container_wrapper").ejWaitingPopup("hide"),parent.$("#editpopup-container_wrapper").ejWaitingPopup("hide")}),$(document).on("show.bs.dropdown",".select-webhook-div",function(){isNullOrWhitespace($("#webhook-option option:selected").val())?!isNullOrWhitespace(scheduleExportInfo.ScheduleExportLocation)&&scheduleExportInfo.ScheduleExportLocation.IsWebhookOptionEnabled?LoadWebhookName(scheduleExportInfo.ScheduleExportLocation.WebhookId):LoadWebhookName():LoadWebhookName($("#webhook-option option:selected").val())});